import{az as e,aB as l,aA as a,r as s,c as u,f as t,k as i,ag as r,y as n,z as c,A as o,P as v,H as d,a5 as p,O as y,a4 as m,K as f,u as g,G as h,L as k,M as C}from"./vendors-123bf75d.js";import{_,u as b,g as w}from"./_plugin-vue_export-helper-71d21a94.js";import{s as S}from"./element-plus-f93db08e.js";const I={class:"search"},A={class:"search-container"},V={key:0,class:"search-suggestions"},T=["onClick"],D={key:1,class:"search-history"},O={class:"history-header"},R={class:"history-tags"},j={key:0,class:"filter-container"},H={key:1,class:"search-results"},E={class:"recipe-content"},L={class:"recipe-info"},x={class:"recipe-tags"},z={class:"ingredients"},U={key:0},q={class:"cooking-time"},F="search_history",G=_({__name:"Search",setup(_){const G=e(),J=l(),K=b(),{recipes:N}=a(K),B=s(""),M=s(!1),P=s(!1),Y=s(!0),$=s(""),Q=s(""),W=s(""),X=u((()=>{const e=K.allDishes.DISH_CHARACTERISTICS.CATEGORIES;return Object.entries(e).map((([e,l])=>({value:l,label:l})))})),Z=u((()=>{const e=K.allDishes.DISH_CHARACTERISTICS.TASTES;return Object.entries(e).map((([e,l])=>({value:l,label:l})))})),ee=u((()=>{const e=K.allDishes.DISH_CHARACTERISTICS.DIFFICULTY;return Object.entries(e).map((([e,l])=>({value:l,label:l})))})),le=s([]),ae=s([]),se=u((()=>{let e=N.value;return $.value&&(e=e.filter((e=>e.category===$.value))),Q.value&&(e=e.filter((e=>e.taste===Q.value))),W.value&&(e=e.filter((e=>e.difficulty===W.value))),e})),ue=()=>{le.value=[],localStorage.removeItem(F)},te=()=>{if(!B.value)return P.value=!1,void(Y.value=!0);const e=K.getAllDishesArray();ae.value=e.filter((e=>e.name.toLowerCase().includes(B.value.toLowerCase())||e.ingredients.some((e=>e.toLowerCase().includes(B.value.toLowerCase()))))).map((e=>e.name)).slice(0,5),P.value=ae.value.length>0,Y.value=!1},ie=e=>{B.value=e,P.value=!1,re()};t([$,Q,W],(async()=>{M.value&&await re()}));const re=async()=>{P.value=!1,Y.value=!1;const e={keyword:B.value.trim(),category:$.value,taste:Q.value,difficulty:W.value};if(!e.keyword&&(e.category||e.taste||e.difficulty))e.keyword="";else if(!e.keyword)return;await K.searchRecipes(e),M.value=!0,e.keyword&&(e=>{if(!e)return;const l=le.value.indexOf(e);l>-1&&le.value.splice(l,1),le.value.unshift(e),le.value.length>10&&(le.value=le.value.slice(0,10)),localStorage.setItem(F,JSON.stringify(le.value))})(e.keyword),G.replace({query:{...J.query,...e}})};return t((()=>J.query.keyword),(async e=>{e&&e!==B.value&&(B.value=e,await re())})),i((()=>{(()=>{const e=localStorage.getItem(F);e&&(le.value=JSON.parse(e))})(),(async()=>{const{keyword:e,category:l,taste:a,difficulty:s}=J.query;e&&(B.value=e),l&&($.value=l),a&&(Q.value=a),s&&(W.value=s),(e||l||a||s)&&await re()})()})),(e,l)=>{const a=r("el-icon"),s=r("el-button"),u=r("el-input"),t=r("el-tag"),i=r("el-option"),_=r("el-select"),b=r("el-image"),F=r("el-card"),J=r("el-empty");return n(),c("div",I,[o("div",A,[v(u,{modelValue:B.value,"onUpdate:modelValue":l[0]||(l[0]=e=>B.value=e),placeholder:"输入食材、菜名、烹饪方法等关键词搜索食谱...",class:"search-input",onKeyup:p(re,["enter"]),onInput:te,clearable:""},{prefix:d((()=>[v(a,null,{default:d((()=>[v(g(S))])),_:1})])),append:d((()=>[v(s,{type:"primary",onClick:re},{default:d((()=>l[4]||(l[4]=[k("搜索")]))),_:1})])),_:1},8,["modelValue"]),P.value&&ae.value.length>0?(n(),c("div",V,[(n(!0),c(y,null,m(ae.value,(e=>(n(),c("div",{key:e,class:"suggestion-item",onClick:l=>ie(e)},C(e),9,T)))),128))])):f("",!0),Y.value&&le.value.length>0?(n(),c("div",D,[o("div",O,[l[6]||(l[6]=o("span",null,"搜索历史",-1)),v(s,{type:"text",onClick:ue},{default:d((()=>l[5]||(l[5]=[k("清空历史")]))),_:1})]),o("div",R,[(n(!0),c(y,null,m(le.value,(e=>(n(),h(t,{key:e,class:"history-tag",onClick:l=>ie(e)},{default:d((()=>[k(C(e),1)])),_:2},1032,["onClick"])))),128))])])):f("",!0)]),g(N).length>0?(n(),c("div",j,[v(_,{modelValue:$.value,"onUpdate:modelValue":l[1]||(l[1]=e=>$.value=e),placeholder:"菜品类别",clearable:""},{default:d((()=>[(n(!0),c(y,null,m(X.value,(e=>(n(),h(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),v(_,{modelValue:Q.value,"onUpdate:modelValue":l[2]||(l[2]=e=>Q.value=e),placeholder:"口味",clearable:""},{default:d((()=>[(n(!0),c(y,null,m(Z.value,(e=>(n(),h(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),v(_,{modelValue:W.value,"onUpdate:modelValue":l[3]||(l[3]=e=>W.value=e),placeholder:"难度",clearable:""},{default:d((()=>[(n(!0),c(y,null,m(ee.value,(e=>(n(),h(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])):f("",!0),se.value.length?(n(),c("div",H,[(n(!0),c(y,null,m(se.value,(e=>(n(),h(F,{key:e.id,class:"recipe-item",onClick:l=>{return a=e.id,void G.push(`/recipe/${a}`);var a}},{default:d((()=>[o("div",E,[v(b,{src:g(w)(e.image),class:"recipe-thumb","preview-src-list":[g(w)(e.image)]},null,8,["src","preview-src-list"]),o("div",L,[o("h3",null,C(e.name),1),o("div",x,[v(t,{size:"small",type:"info"},{default:d((()=>[k(C(e.category),1)])),_:2},1024),v(t,{size:"small",type:"success"},{default:d((()=>[k(C(e.taste),1)])),_:2},1024),v(t,{size:"small",type:"warning"},{default:d((()=>[k(C(e.difficulty),1)])),_:2},1024)]),o("p",z,[k(" 主料: "+C(e.ingredients.slice(0,3).join(", "))+" ",1),e.ingredients.length>3?(n(),c("span",U,"等")):f("",!0)]),o("p",q,"烹饪时间: "+C(e.cookingTime),1)])])])),_:2},1032,["onClick"])))),128))])):M.value?(n(),h(J,{key:2,description:"没有找到相关食谱"})):f("",!0)])}}},[["__scopeId","data-v-9d25560c"]]);export{G as default};
